<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>UK Sponsor Lookup | Check Visa Sponsors</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5276;
            --primary-dark: #154360;
            --success: #27ae60;
            --warning: #f39c12;
            --error: #e74c3c;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.025em;
        }

        .hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .container {
            max-width: 800px;
            margin: -3rem auto 4rem;
            padding: 0 2rem;
            position: relative;
            z-index: 2;
        }

        .search-card {
            background: var(--card);
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--bg);
            padding: 0.375rem;
            border-radius: 0.75rem;
        }

        .tab {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 0.5rem;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-muted);
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        input[type="text"] {
            width: 100%;
            padding: 1rem 1.25rem 1rem 3.25rem;
            border: 2px solid var(--border);
            border-radius: 1rem;
            font-size: 1rem;
            transition: all 0.2s;
            font-family: inherit;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(26, 82, 118, 0.1);
        }

        input[type="text"]::placeholder {
            color: var(--text-muted);
        }

        .search-btn {
            width: 100%;
            margin-top: 1rem;
            padding: 1rem 2rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .search-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 82, 118, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-container {
            margin-top: 2rem;
        }

        .result-card {
            background: var(--card);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 2px solid var(--border);
            transition: all 0.2s;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card.confirmed {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.05) 0%, rgba(39, 174, 96, 0.02) 100%);
        }

        .result-card.possible {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.05) 0%, rgba(243, 156, 18, 0.02) 100%);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .company-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            line-height: 1.4;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge.confirmed {
            background: var(--success);
            color: white;
        }

        .badge.possible {
            background: var(--warning);
            color: white;
        }

        .match-score {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .details-grid {
            display: grid;
            gap: 0.75rem;
        }

        .detail-row {
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
        }

        .detail-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-muted);
            min-width: 80px;
        }

        .detail-value {
            font-size: 0.9375rem;
            color: var(--text);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .error-state {
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 1rem;
            padding: 1.5rem;
            color: var(--error);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .hidden {
            display: none !important;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-attribution {
            margin-bottom: 0.75rem;
        }

        .footer-licence {
            background: rgba(26, 82, 118, 0.05);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin: 0.75rem 0;
            font-size: 0.8125rem;
        }

        .footer-disclaimer {
            font-size: 0.75rem;
            color: #94a3b8;
            margin: 0.75rem 0;
            line-height: 1.5;
        }

        .footer-meta {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .external-links {
            margin-top: 1.25rem;
            padding-top: 1.25rem;
            border-top: 1px solid var(--border);
        }

        .links-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .links-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .link-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.875rem;
            border-radius: 0.5rem;
            font-size: 0.8125rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .link-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .link-btn.linkedin {
            background: #0077b5;
            color: white;
        }

        .link-btn.indeed {
            background: #2557a7;
            color: white;
        }

        .link-btn.glassdoor {
            background: #0caa41;
            color: white;
        }

        .link-btn.google {
            background: #f8f9fa;
            color: #5f6368;
            border-color: #dadce0;
        }

        .link-btn.google:hover {
            background: #f1f3f4;
        }

        .link-btn.website {
            background: #7c3aed;
            color: white;
        }

        .link-btn.secondary {
            background: rgba(0, 119, 181, 0.1);
            color: #0077b5;
            border: 1px solid rgba(0, 119, 181, 0.3);
        }

        .link-btn.secondary:hover {
            background: rgba(0, 119, 181, 0.2);
        }

        .source-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.125rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-left: 0.5rem;
        }

        .source-badge.cache {
            background: #10b981;
            color: white;
        }

        .source-badge.google_api {
            background: #3b82f6;
            color: white;
        }

        .source-badge.algorithmic {
            background: #9ca3af;
            color: white;
        }

        /* SVG Icons */
        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        @media (max-width: 640px) {
            .hero {
                padding: 3rem 1.5rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .stats-bar {
                gap: 2rem;
            }

            .container {
                margin-top: -2rem;
                padding: 0 1rem;
            }

            .search-card {
                padding: 1.5rem;
            }

            .result-header {
                flex-direction: column;
                gap: 0.75rem;
            }

            .badge {
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <header class="hero">
        <div class="hero-content">
            <h1>UK Sponsor Lookup</h1>
            <p>Check if a company is a registered UK visa sponsor</p>
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value">140K+</div>
                    <div class="stat-label">Sponsors</div>
                </div>
                <div class="stat">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">Official Data</div>
                </div>
                <div class="stat">
                    <div class="stat-value">Free</div>
                    <div class="stat-label">Forever</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="search-card">
            <div class="tabs">
                <button class="tab active" onclick="setTab('company')">
                    <svg class="icon" style="width:16px;height:16px;margin-right:6px;vertical-align:text-bottom;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    Company Name
                </button>
                <button class="tab" onclick="setTab('url')">
                    <svg class="icon" style="width:16px;height:16px;margin-right:6px;vertical-align:text-bottom;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
                    Job URL
                </button>
            </div>
            
            <div id="company-input" class="input-wrapper">
                <svg class="input-icon" style="width:20px;height:20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                <input type="text" id="company-name" placeholder="Enter company name (e.g., NHS, Barclays, Google)" onkeypress="handleEnter(event)">
            </div>
            
            <div id="url-input" class="input-wrapper hidden">
                <svg class="input-icon" style="width:20px;height:20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
                <input type="text" id="job-url" placeholder="Paste job posting URL (LinkedIn, Indeed, etc.)" onkeypress="handleEnter(event)">
            </div>

            <button class="search-btn" id="search-btn" onclick="currentTab === 'company' ? search() : searchUrl()">
                <svg style="width:20px;height:20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                Search Sponsors
            </button>
        </div>

        <div id="results" class="results-container hidden">
            <!-- Results appear here -->
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-attribution">
                <strong>Data Source:</strong> 
                <a href="https://www.gov.uk/government/publications/register-of-licensed-sponsors-workers" target="_blank">
                    UK Government Register of Licensed Sponsors
                </a>
            </p>
            <p class="footer-licence">
                Contains public sector information licensed under the 
                <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">
                    Open Government Licence v3.0
                </a>
            </p>
            <p class="footer-disclaimer">
                <strong>Disclaimer:</strong> Not affiliated with or endorsed by the UK Government. 
                Data provided "as is" without warranty. Always verify with 
                <a href="https://www.gov.uk/government/publications/register-of-licensed-sponsors-workers" target="_blank">official sources</a> 
                before making decisions.
            </p>
            <p class="footer-meta">Last updated: February 2026 ‚Ä¢ 140,000+ sponsors</p>
        </div>
    </footer>

    <script>
        const API_BASE = window.location.origin.includes('localhost') ? 'http://localhost:5000' : '';
        let currentTab = 'company';

        function setTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');
            
            if (tab === 'company') {
                document.getElementById('company-input').classList.remove('hidden');
                document.getElementById('url-input').classList.add('hidden');
            } else {
                document.getElementById('company-input').classList.add('hidden');
                document.getElementById('url-input').classList.remove('hidden');
            }
            
            // Clear results when switching tabs
            document.getElementById('results').classList.add('hidden');
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                currentTab === 'company' ? search() : searchUrl();
            }
        }

        function setLoading(loading) {
            const btn = document.getElementById('search-btn');
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<div class="spinner"></div>Searching...';
            } else {
                btn.disabled = false;
                btn.innerHTML = `<svg style="width:20px;height:20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Search Sponsors`;
            }
        }

        function showError(message) {
            const results = document.getElementById('results');
            results.classList.remove('hidden');
            results.innerHTML = `
                <div class="error-state">
                    <svg style="width:24px;height:24px;flex-shrink:0;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    <span>${escapeHtml(message)}</span>
                </div>
            `;
        }

        function showEmpty() {
            const results = document.getElementById('results');
            results.classList.remove('hidden');
            results.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üîç</div>
                    <h3>No sponsors found</h3>
                    <p>Try a different company name or check your spelling</p>
                </div>
            `;
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.remove('hidden');
            
            if (data.results && data.results.length === 0) {
                showEmpty();
                return;
            }

            let html = '';
            data.results.forEach((result, index) => {
                const isConfirmed = result.is_confirmed;
                const statusClass = isConfirmed ? 'confirmed' : 'possible';
                const statusText = isConfirmed ? '‚úì Confirmed Sponsor' : 'Possible Match';
                const delay = index * 0.1;
                
                html += `
                    <div class="result-card ${statusClass}" style="animation-delay: ${delay}s">
                        <div class="result-header">
                            <div class="company-name">${escapeHtml(result.name)}</div>
                            <span class="badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="match-score">Match confidence: ${(result.match_score * 100).toFixed(0)}%</div>
                        <div class="details-grid">
                            <div class="detail-row">
                                <span class="detail-label">Location</span>
                                <span class="detail-value">${escapeHtml(result.city)}${result.county ? ', ' + escapeHtml(result.county) : ''}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Rating</span>
                                <span class="detail-value">${escapeHtml(result.rating)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Route</span>
                                <span class="detail-value">${escapeHtml(result.route)}</span>
                            </div>
                        </div>
                        ${result.links ? `
                        <div class="external-links">
                            <div class="links-label">
                                Find on:
                                ${result.links.source ? `<span class="source-badge ${result.links.source}">${result.links.source}</span>` : ''}
                            </div>
                            <div class="links-row">
                                ${result.links.linkedin ? `
                                <a href="${result.links.linkedin}" target="_blank" class="link-btn linkedin">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                    LinkedIn
                                </a>
                                ` : ''}
                                <a href="${result.links.linkedin_search}" target="_blank" class="link-btn linkedin ${result.links.linkedin ? 'secondary' : ''}">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                    ${result.links.linkedin ? 'Search LinkedIn' : 'LinkedIn'}
                                </a>
                                <a href="${result.links.indeed_search}" target="_blank" class="link-btn indeed">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M14.571 0c.179 0 .357.014.532.042l.016.003c1.656.154 3.04 1.186 3.547 2.691l.003.01c.113.338.175.694.185 1.053v17.15c-.01.36-.073.715-.186 1.053l-.003.01c-.507 1.505-1.891 2.537-3.547 2.691l-.016.003c-.175.028-.353.042-.532.042H9.43c-.18 0-.357-.014-.533-.042l-.015-.003c-1.656-.154-3.04-1.186-3.547-2.691l-.003-.01a3.916 3.916 0 0 1-.186-1.053V3.8c.01-.36.073-.715.186-1.053l.003-.01C5.842 1.232 7.226.2 8.882.046l.015-.003C9.073.014 9.251 0 9.43 0h5.142zm-1.03 18.544H9.59v2.206h3.95v-2.206zm-.25-11.69H9.84v8.63h3.45v-8.63zm-5.957 0H4.404v8.63h3.45v-8.63zm-.1-3.23H4.303v2.206h3.95V3.624h.001z"/></svg>
                                    Indeed
                                </a>
                                <a href="${result.links.glassdoor_search}" target="_blank" class="link-btn glassdoor">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M17.144 20.572h3.424V3.428H3.433v16.572h10.286c-.54.857-.857 1.714-.857 2.572H.144V.286h23.715v24h-7.715c0-.858-.317-1.715-.857-2.572l.001-.001zM10.858 6h5.714v4.286h-5.714V6zm-5.715 0h5.715v4.286H5.143V6zm10.285 5.714H5.143v1.714h10.285v-1.714zm0 2.857H5.143v1.714h10.285v-1.714z"/></svg>
                                    Glassdoor
                                </a>
                                ${result.links.website ? `
                                <a href="${result.links.website}" target="_blank" class="link-btn website">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                                    Website
                                </a>
                                ` : ''}
                                <a href="${result.links.google}" target="_blank" class="link-btn google">
                                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                    Website
                                </a>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function escapeHtml(text) {
            if (!text) return 'N/A';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function search() {
            const company = document.getElementById('company-name').value.trim();
            if (!company) {
                showError('Please enter a company name');
                return;
            }

            setLoading(true);

            try {
                const response = await fetch(`${API_BASE}/api/search?company=${encodeURIComponent(company)}&limit=5`);
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                } else {
                    displayResults(data);
                }
            } catch (error) {
                showError('Unable to connect to server. Please try again later.');
            } finally {
                setLoading(false);
            }
        }

        async function searchUrl() {
            const url = document.getElementById('job-url').value.trim();
            if (!url) {
                showError('Please enter a job posting URL');
                return;
            }

            setLoading(true);

            try {
                const response = await fetch(`${API_BASE}/api/url`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                } else if (!data.extracted_company) {
                    showError('Could not extract company name from this URL. Try entering the company name directly.');
                } else if (!data.is_sponsor) {
                    showError(`"${escapeHtml(data.extracted_company)}" is not a registered UK visa sponsor.`);
                } else {
                    displayResults({
                        results: [{
                            name: data.sponsor_details.name,
                            city: data.sponsor_details.city,
                            county: data.sponsor_details.county,
                            rating: data.sponsor_details.rating,
                            route: data.sponsor_details.route,
                            match_score: 1.0,
                            is_confirmed: true
                        }]
                    });
                }
            } catch (error) {
                showError('Unable to connect to server. Please try again later.');
            } finally {
                setLoading(false);
            }
        }
    </script>
</body>
</html>
